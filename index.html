<!-- ê¸°ì¡´ <script type="module"> ... </script> ì „ì²´ë¥¼ ì•„ë˜ë¡œ êµì²´ -->

<script>
  // Firebase ì—†ì´ë„ ë™ì‘í•˜ëŠ” ê¸°ë³¸ ê¸°ëŠ¥
  var DAYS = ['ì¼ìš”ì¼','ì›”ìš”ì¼','í™”ìš”ì¼','ìˆ˜ìš”ì¼','ëª©ìš”ì¼','ê¸ˆìš”ì¼','í† ìš”ì¼'];

  function showDay(val, id) {
    var el = document.getElementById(id);
    if (!val) { el.textContent = ''; return; }
    var p = val.split('-');
    var d = new Date(parseInt(p[0]), parseInt(p[1])-1, parseInt(p[2]));
    el.textContent = (d.getMonth()+1) + 'ì›” ' + d.getDate() + 'ì¼ ' + DAYS[d.getDay()];
  }

  document.getElementById('startDate').addEventListener('change', function() {
    showDay(this.value, 'startDayLabel');
  });
  document.getElementById('endDate').addEventListener('change', function() {
    showDay(this.value, 'endDayLabel');
  });

  // ê¸°ë³¸ ë‚ ì§œ
  function pad(n) { return String(n).padStart(2,'0'); }
  var t = new Date();
  var t2 = new Date(); t2.setDate(t.getDate()+14);
  var todayStr = t.getFullYear()+'-'+pad(t.getMonth()+1)+'-'+pad(t.getDate());
  var endStr   = t2.getFullYear()+'-'+pad(t2.getMonth()+1)+'-'+pad(t2.getDate());
  document.getElementById('startDate').value = todayStr; showDay(todayStr, 'startDayLabel');
  document.getElementById('endDate').value   = endStr;   showDay(endStr,   'endDayLabel');

  // ì‹œê°„ ì˜µì…˜
  var ss = document.getElementById('startTime');
  var se = document.getElementById('endTime');
  for (var h = 0; h <= 24; h++) {
    var lbl = h === 0 ? 'ì˜¤ì „ 12ì‹œ' : h < 12 ? 'ì˜¤ì „ '+h+'ì‹œ' : h === 12 ? 'ì˜¤í›„ 12ì‹œ' : h < 24 ? 'ì˜¤í›„ '+(h-12)+'ì‹œ' : 'ìì • 12ì‹œ';
    ss.add(new Option(lbl, h));
    se.add(new Option(lbl, h));
  }
  ss.value = 9; se.value = 22;

  // ë¼ë””ì˜¤ ë²„íŠ¼
  document.querySelectorAll('input[name="timeUnit"]').forEach(function(r) {
    r.addEventListener('change', function() {
      document.querySelectorAll('.radio-btn').forEach(function(l) { l.classList.remove('active'); });
      r.closest('.radio-btn').classList.add('active');
    });
  });

  // ë°© ë§Œë“¤ê¸°
  document.getElementById('createRoomBtn').addEventListener('click', function() {
    var name  = document.getElementById('bandName').value.trim();
    var start = document.getElementById('startDate').value;
    var end   = document.getElementById('endDate').value;
    var st    = document.getElementById('startTime').value;
    var et    = document.getElementById('endTime').value;
    var unit  = document.querySelector('input[name="timeUnit"]:checked').value;
    var count = document.getElementById('memberCount').value;

    if (!name)           { alert('ë°´ë“œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ¸'); return; }
    if (!start || !end)  { alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ“…'); return; }
    if (new Date(start) > new Date(end)) { alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì–´ìš”!'); return; }
    if (parseInt(st) >= parseInt(et))    { alert('ì¢…ë£Œ ì‹œê°„ì´ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•´ìš”!'); return; }
    if (!count)          { alert('ì¸ì› ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

    var roomId = 'room_' + Math.random().toString(36).substr(2, 8);
    var p = new URLSearchParams({ id: roomId, name: name, start: start, end: end, startTime: st, endTime: et, unit: unit, members: count });
    var link = window.location.origin + '/room.html?' + p.toString();

    document.getElementById('shareLink').textContent = link;
    document.getElementById('resultBox').style.display = 'block';
    document.getElementById('resultBox').scrollIntoView({ behavior: 'smooth', block: 'center' });

    // Firebase ì €ì¥ (ì—°ê²°ëœ ê²½ìš°ì—ë§Œ)
    if (window._db) {
      window._set(window._ref(window._db, 'rooms/'+roomId+'/info'), {
        name: name, start: start, end: end,
        startTime: st, endTime: et, unit: unit, members: count
      });
    }
  });

  // ë§í¬ ë³µì‚¬
  document.getElementById('copyLinkBtn').addEventListener('click', function() {
    var link = document.getElementById('shareLink').textContent;
    navigator.clipboard.writeText(link).then(function() {
      alert('âœ… ë§í¬ê°€ ë³µì‚¬ëì–´ìš”!');
    }).catch(function() {
      var el = document.createElement('textarea');
      el.value = link; document.body.appendChild(el);
      el.select(); document.execCommand('copy');
      document.body.removeChild(el);
      alert('âœ… ë§í¬ê°€ ë³µì‚¬ëì–´ìš”!');
    });
  });
</script>

<script type="module">
  // FirebaseëŠ” ë³„ë„ë¡œ ë¡œë“œ (ì‹¤íŒ¨í•´ë„ ìœ„ ê¸°ëŠ¥ì€ ì •ìƒ ë™ì‘)
  try {
    var { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js");
    var { getDatabase, ref, set } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js");
    var firebaseConfig = {
      apiKey: "AIzaSyCb_CrMi2fc8qB6HvV92DDI77JDmCqGvpY",
      authDomain: "jamflow-dd033.firebaseapp.com",
      databaseURL: "https://jamflow-dd033-default-rtdb.firebaseio.com",
      projectId: "jamflow-dd033",
      storageBucket: "jamflow-dd033.firebasestorage.app",
      messagingSenderId: "913570760402",
      appId: "1:913570760402:web:18450473aa2b0a25b18f0b"
    };
    window._db  = getDatabase(initializeApp(firebaseConfig));
    window._ref = ref;
    window._set = set;
  } catch(e) {
    console.log('Firebase ì—°ê²° ì‹¤íŒ¨:', e);
  }
</script>